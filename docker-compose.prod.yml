# Production Docker Compose Overrides
# Usage: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
#
# Zero Trust Security Enhancements:
# - Database ports NOT exposed to host (internal Docker network only)
# - Redis port NOT exposed
# - OPA port NOT exposed
# - Only public-facing services (frontend, backend, keycloak) exposed through cloudflared
# - All internal communication stays within Docker network

version: '3.8'

services:
  # PostgreSQL - NO external port exposure (Zero Trust)
  postgres:
    ports: []

  # MongoDB - NO external port exposure (Zero Trust)
  mongo:
    ports: []

  # Redis - NO external port exposure (Zero Trust)
  redis:
    ports: []

  # OPA - NO external port exposure (Zero Trust)
  # Internal access only via Docker network at http://opa:8181
  opa:
    ports: []

  # AuthzForce - NO external port exposure (Zero Trust)
  authzforce:
    ports: []

  # Keycloak - Only HTTPS exposed (no HTTP)
  keycloak:
    ports:
      - "8443:8443"   # HTTPS only (defense in depth)

  # Frontend - Access via Cloudflare Tunnel only
  frontend:
    ports: []

  # Backend - Access via Cloudflare Tunnel only
  backend:
    ports: []

  # KAS - Access via Cloudflare Tunnel only
  kas:
    ports: []

  # Cloudflared metrics - localhost only for monitoring
  cloudflared:
    ports:
      - "127.0.0.1:9126:9126"  # Localhost only for metrics
