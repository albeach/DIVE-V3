# ============================================
# DIVE V3 - France (FRA) Instance Environment
# ============================================
# Generated: November 24, 2025
# DO NOT COMMIT THIS FILE

# ============================================
# Instance Identification
# ============================================
INSTANCE_ID=fra
INSTANCE_REALM=dive-v3-broker-fra
ORIGIN_REALM=FRA
INSTANCE_NAME="France Instance"
INSTANCE_LOCALE=fr

# ============================================
# Cloudflare Configuration
# ============================================
CF_TUNNEL_PRIMARY=dive-v3-fra-primary
CF_TUNNEL_STANDBY=dive-v3-fra-standby
CF_ZONE_ID=your-zone-id-here
CF_ACCOUNT_ID=your-account-id-here
CF_API_TOKEN=your-api-token-here

# FRA Hostnames
FRA_FRONTEND_HOST=fra-app.dive25.com
FRA_API_HOST=fra-api.dive25.com
FRA_IDP_HOST=fra-idp.dive25.com
FRA_KAS_HOST=fra-kas.dive25.com

# ============================================
# Keycloak Configuration
# ============================================
KEYCLOAK_BASE_URL=https://fra-idp.dive25.com
KEYCLOAK_INTERNAL_URL=http://keycloak-fra:8080
KEYCLOAK_REALM=dive-v3-broker-fra
KEYCLOAK_CLIENT_ID=dive-v3-client-fra
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=admin

# Client secrets (generate with: openssl rand -hex 32)
FRA_CLIENT_SECRET=8bcf4d2e9a1c3f5b7d8e2a4c6b8d1f3e5a7c9e1b3d5f7a9c1e3b5d7f9a1c3e5b
FRA_BROKER_SECRET=7a9c1e3b5d7f9a1c3e5b8bcf4d2e9a1c3f5b7d8e2a4c6b8d1f3e5a7c9e1b3d

# ============================================
# Backend API Configuration
# ============================================
BACKEND_PORT=4000
BACKEND_URL=https://fra-api.dive25.com
LOG_LEVEL=debug
LOG_FORMAT=json
NODE_ENV=production

# Resource Configuration
RESOURCE_PREFIX=FRA-
ENABLE_CORRELATION_ID=true

# ============================================
# Frontend Configuration
# ============================================
NEXT_PUBLIC_BASE_URL=https://fra-app.dive25.com
NEXT_PUBLIC_API_URL=https://fra-api.dive25.com
NEXT_PUBLIC_BACKEND_URL=https://fra-api.dive25.com
AUTH_URL=https://fra-app.dive25.com
NEXTAUTH_URL=https://fra-app.dive25.com

# NextAuth secret (generate with: openssl rand -base64 32)
AUTH_SECRET=fR4Nc3+S3cR3t+K3y+F0r+N3xtAuth+S3ss10n+2025=
FRA_AUTH_SECRET=fR4Nc3+S3cR3t+K3y+F0r+N3xtAuth+S3ss10n+2025=

# ============================================
# Database Configuration
# ============================================
# Keycloak Database
POSTGRES_KC_HOST=postgres-fra
POSTGRES_KC_PORT=5432
POSTGRES_KC_DB=keycloak_fra
POSTGRES_KC_USER=keycloak
POSTGRES_KC_PASSWORD=keycloak

# App Database (NextAuth)
POSTGRES_APP_HOST=postgres-app-fra
POSTGRES_APP_PORT=5432
POSTGRES_APP_DB=nextauth_fra
POSTGRES_APP_USER=nextauth
POSTGRES_APP_PASSWORD=nextauth
DATABASE_URL=postgresql://nextauth:nextauth@postgres-app-fra:5432/nextauth_fra

# MongoDB
MONGODB_HOST=mongodb-fra
MONGODB_PORT=27017
MONGODB_DATABASE=dive-v3-fra
MONGODB_URL=mongodb://admin:admin@mongodb-fra:27017
MONGODB_USER=admin
MONGODB_PASSWORD=admin

# Redis
REDIS_HOST=redis-fra
REDIS_PORT=6379
REDIS_URL=redis://redis-fra:6379

# ============================================
# OPA Configuration
# ============================================
OPA_URL=http://opa-fra:8181
OPA_DECISION_PATH=/v1/data/dive/authorization/decision
OPA_BUNDLE_PATH=/policies
OPA_LOG_LEVEL=info
OPA_LOG_FORMAT=json

# Clearance Mapping (French to NATO)
OPA_CLEARANCE_MAP='{
  "CONFIDENTIEL_DEFENSE": "CONFIDENTIAL",
  "SECRET_DEFENSE": "SECRET",
  "TRES_SECRET_DEFENSE": "TOP_SECRET",
  "NON_PROTEGE": "UNCLASSIFIED"
}'

# ============================================
# KAS Configuration
# ============================================
KAS_URL=http://kas-fra:8080
KAS_NAMESPACE=FRA
KAS_AUTHORITY=origin
ENABLE_CROSS_KAS=true
LOG_MISMATCHES=true

# ============================================
# Federation Configuration
# ============================================
# USA Instance
USA_FRONTEND_URL=https://dev-app.dive25.com
USA_API_URL=https://dev-api.dive25.com
USA_IDP_URL=https://dev-auth.dive25.com
USA_KAS_URL=https://dev-kas.dive25.com

# Federation endpoints
USA_FEDERATION_ENDPOINT=https://dev-api.dive25.com/federation
USA_JWKS_URL=https://dev-auth.dive25.com/realms/dive-v3-broker/protocol/openid-connect/certs

# Federation credentials (to be provided by USA admin)
USA_FRA_CLIENT_ID=fra-federation-client
USA_FRA_CLIENT_SECRET=to-be-provided

# Federation sync
FEDERATION_SYNC_INTERVAL=300  # 5 minutes in seconds
FEDERATION_SYNC_ENABLED=true
FEDERATION_CONFLICT_RESOLUTION=origin-wins

# ============================================
# Security Configuration
# ============================================
# TLS
TLS_ENABLED=true
TLS_CERT=/app/certs/certificate.pem
TLS_KEY=/app/certs/key.pem
NODE_TLS_REJECT_UNAUTHORIZED=0  # Development only

# JWT
JWT_VALIDATION=strict
JWT_ISSUER=https://fra-idp.dive25.com/realms/dive-v3-broker-fra
JWT_AUDIENCE=dive-v3-client-fra
TOKEN_LIFETIME=900  # 15 minutes
REFRESH_TOKEN_LIFETIME=43200  # 12 hours (French preference)

# Session
SESSION_IDLE_TIMEOUT=1800  # 30 minutes
SESSION_MAX_LIFETIME=43200  # 12 hours

# ============================================
# Monitoring & Observability
# ============================================
METRICS_ENABLED=true
METRICS_PORT=2000
HEALTH_CHECK_INTERVAL=30
ENABLE_TRACING=true
JAEGER_ENDPOINT=http://jaeger-fra:14268/api/traces

# ============================================
# Localization
# ============================================
DEFAULT_LOCALE=fr
SUPPORTED_LOCALES=fr,en
TIMEZONE=Europe/Paris

# ============================================
# Feature Flags
# ============================================
ENABLE_WEBAUTHN=true
ENABLE_TOTP=true
ENABLE_SAML=true
ENABLE_OIDC=true
ENABLE_FEDERATION=true
ENABLE_KAS_INTEGRATION=true
ENABLE_AUDIT_LOGGING=true

# ============================================
# Gap Mitigations
# ============================================
# GAP-001: Trust Anchor Lifecycle
JWKS_ROTATION_INTERVAL=7776000  # 90 days
CERT_ROTATION_WARNING_DAYS=30

# GAP-002: Attribute Normalization
ENABLE_ATTRIBUTE_NORMALIZATION=true
FAIL_SECURE_ON_MISSING_ATTRIBUTES=true

# GAP-003: Resource Consistency
ENFORCE_RESOURCE_PREFIX=true
ENABLE_VERSION_CONTROL=true

# GAP-004: Audit Correlation
ENABLE_CORRELATION_ID=true
USE_UTC_TIMESTAMPS=true

# GAP-005: Multi-KAS Divergence
LOG_KAS_MISMATCHES=true
ALERT_ON_DIVERGENCE=true

# GAP-006: Availability
ENABLE_HEALTH_CHECKS=true
FAILOVER_TIMEOUT=30

# GAP-007: Data Residency
ENFORCE_DATA_RESIDENCY=true
DATA_LOCATION=EU-FR

# GAP-010: MongoDB Isolation
MONGODB_ISOLATION=true
SEPARATE_DATABASE_PER_REALM=true



