# DIVE V3 Certificate Infrastructure

Generated: 2025-10-21T22:00:33.683Z

## Certificate Hierarchy

```
Root CA (self-signed, 10-year)
  └─ Intermediate CA (5-year)
       └─ Policy Signing Certificate (2-year)
```

## Files

### Certificate Authority
- `ca/root.key` - Root CA private key (4096-bit, encrypted)
- `ca/root.crt` - Root CA certificate
- `ca/intermediate.key` - Intermediate CA private key (2048-bit, encrypted)
- `ca/intermediate.crt` - Intermediate CA certificate
- `ca/chain.pem` - Full certificate chain (root + intermediate)

### Policy Signing
- `signing/policy-signer.key` - Policy signing private key (2048-bit)
- `signing/policy-signer.crt` - Policy signing certificate
- `signing/policy-signer-bundle.pem` - Certificate + chain

### Certificate Revocation
- `crl/root-crl.pem` - Root CA certificate revocation list
- `crl/intermediate-crl.pem` - Intermediate CA certificate revocation list

## Security Notes

1. **Private Key Protection**
   - Root and Intermediate CA keys are encrypted with AES-256-CBC
   - Policy signing key is unencrypted for operational use
   - All private keys have `chmod 600` permissions (owner read/write only)

2. **Passphrase Management**
   - Set `CA_KEY_PASSPHRASE` environment variable for decryption
   - Default passphrase: `dive-v3-ca-passphrase-change-in-production`
   - **CRITICAL:** Change passphrase in production deployment

3. **Certificate Lifetimes**
   - Root CA: 10 years (rarely renewed)
   - Intermediate CA: 5 years (rotate every 3-5 years)
   - Policy Signing: 2 years (rotate annually)

4. **Production Deployment**
   - Replace self-signed root CA with enterprise PKI root
   - Store private keys in HSM (Hardware Security Module)
   - Implement OCSP for real-time revocation checking

## Environment Variables

```bash
# Certificate paths
PKI_ROOT_CA_PATH=backend/certs/ca/root.crt
PKI_INTERMEDIATE_CA_PATH=backend/certs/ca/intermediate.crt
PKI_SIGNING_CERT_PATH=backend/certs/signing/policy-signer.crt
PKI_SIGNING_KEY_PATH=backend/certs/signing/policy-signer.key

# CA passphrase
CA_KEY_PASSPHRASE=<your-secure-passphrase>

# Signature verification
PKI_ENABLE_SIGNATURE_VERIFICATION=true
PKI_CLOCK_SKEW_TOLERANCE_MS=300000  # ±5 minutes
```

## Regeneration

To regenerate certificates:

```bash
npm run generate-ca -- --renew
```

**WARNING:** This will replace all certificates and invalidate existing signatures.

## Compliance

- **NATO ACP-240 Section 5.4:** Cryptographic Binding & Integrity
- **STANAG 4778:** X.509 PKI for policy signatures
- **RFC 5280:** X.509 certificate and CRL profile

---

*Generated by: backend/src/scripts/generate-three-tier-ca.ts*
