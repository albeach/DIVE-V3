# ===========================================
# DIVE V3 Backend - Environment Variables
# ===========================================
# This is a TEMPLATE file. Copy to .env and fill in actual values.
# NEVER commit .env files to git!
#
# Setup: cp .env.example .env
# Then: Edit .env with your actual secrets

# ===========================================
# Keycloak Configuration
# ===========================================

# Keycloak Admin Credentials (for REST API management)
KEYCLOAK_ADMIN_USER=admin
KEYCLOAK_ADMIN_PASSWORD=admin

# Keycloak URLs
# Internal (Docker network): http://keycloak:8080
# External (browser): http://localhost:8081
KEYCLOAK_URL=http://keycloak:8080
KEYCLOAK_REALM=dive-v3-pilot

# Keycloak Client (for NextAuth)
KEYCLOAK_CLIENT_ID=dive-v3-client
KEYCLOAK_CLIENT_SECRET=<COPY_FROM_TERRAFORM_OUTPUT>

# JWKS for JWT verification
KEYCLOAK_JWKS_URI=http://keycloak:8080/realms/dive-v3-pilot/protocol/openid-connect/certs

# ===========================================
# MongoDB Configuration
# ===========================================

# Connection string with credentials
MONGODB_URL=mongodb://admin:password@mongo:27017

# Database name
MONGODB_DATABASE=dive-v3

# Connection pool settings (optional)
MONGODB_MAX_POOL_SIZE=10
MONGODB_MIN_POOL_SIZE=2

# ===========================================
# OPA (Open Policy Agent)
# ===========================================

# OPA base URL (no auth for pilot)
OPA_URL=http://opa:8181

# Decision cache TTL (seconds)
OPA_DECISION_CACHE_TTL=60

# ===========================================
# KAS (Key Access Service)
# ===========================================

# KAS base URL (for encrypted resources)
KAS_URL=http://kas:8080

# ===========================================
# Backend Server Configuration
# ===========================================

# Server port
PORT=4000

# Node environment
NODE_ENV=development

# Log level: error | warn | info | debug
LOG_LEVEL=info

# Log format: json | pretty
LOG_FORMAT=json

# ===========================================
# Auth0 MCP Integration (Optional)
# ===========================================

# Auth0 tenant domain
AUTH0_DOMAIN=your-tenant.auth0.com

# Enable Auth0 MCP integration
AUTH0_MCP_ENABLED=false

# Auth0 credentials (if MCP enabled)
# AUTH0_CLIENT_ID=<YOUR_AUTH0_CLIENT_ID>
# AUTH0_CLIENT_SECRET=<YOUR_AUTH0_CLIENT_SECRET>

# ===========================================
# Frontend URL (for CORS)
# ===========================================

FRONTEND_URL=http://localhost:3000

# ===========================================
# Observability (Phase 0)
# ===========================================

# Enable Prometheus metrics
PROMETHEUS_ENABLED=true

# Metrics port (if separate from main server)
# PROMETHEUS_PORT=9090

# ===========================================
# Security Settings
# ===========================================

# JWT token settings
JWT_ISSUER=dive-v3-backend
JWT_AUDIENCE=dive-v3-api

# Request rate limiting (requests per minute)
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# ===========================================
# Development Settings
# ===========================================

# Enable debug mode (extra logging)
DEBUG=false

# Enable mock IdPs (for testing without Keycloak)
MOCK_IDPS_ENABLED=false

# ===========================================
# Future Configuration (Phases 1-4)
# ===========================================

# Phase 1: Validation (ACTIVE)
# TLS and cryptography validation for IdP submissions
TLS_MIN_VERSION=1.2
ALLOWED_SIGNATURE_ALGORITHMS=RS256,RS512,ES256,ES512,PS256,PS512
DENIED_SIGNATURE_ALGORITHMS=HS1,MD5,SHA1,RS1,none
ENDPOINT_TIMEOUT_MS=5000
# Strict mode: reject SHA-1 and self-signed certs (false for pilot)
VALIDATION_STRICT_MODE=false
# Allow self-signed certificates (true for pilot, false for production)
ALLOW_SELF_SIGNED_CERTS=true
# Record validation metrics
RECORD_VALIDATION_METRICS=true

# ===========================================
# Phase 2: Risk Scoring & Compliance Automation
# ===========================================

# Auto-Triage Thresholds (0-100 points)
AUTO_APPROVE_THRESHOLD=85          # Minimal risk (gold tier) - auto-approve
FAST_TRACK_THRESHOLD=70            # Low risk (silver tier) - fast-track queue
AUTO_REJECT_THRESHOLD=50           # High risk threshold - reject or detailed review

# SLA Deadlines (hours)
FAST_TRACK_SLA_HOURS=2             # Fast-track review deadline
STANDARD_REVIEW_SLA_HOURS=24       # Standard review deadline
DETAILED_REVIEW_SLA_HOURS=72       # Detailed review deadline

# Compliance Requirements
COMPLIANCE_STRICT_MODE=false       # Strict compliance enforcement (reject non-compliant)
REQUIRE_ACP240_CERT=false          # Require ACP-240 certification upload
REQUIRE_MFA_POLICY_DOC=false       # Require MFA policy document upload

# Operational Requirements (for scoring)
MINIMUM_UPTIME_SLA=99.0            # Minimum uptime SLA percentage
REQUIRE_247_SUPPORT=false          # Require 24/7 support availability
MAX_PATCHING_DAYS=90               # Maximum security patching window (days)

# ===========================================
# Phase 4: Secrets Management
# ===========================================
# VAULT_ADDR=http://vault:8200
# VAULT_TOKEN=<YOUR_VAULT_TOKEN>
# AWS_SECRETS_MANAGER_REGION=us-east-1

