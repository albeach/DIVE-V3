# ============================================
# DIVE V3 - Production Environment Configuration (Phase 3)
# ============================================
# Copy this file to .env.production and fill in actual values
# NEVER commit .env.production to version control

# ============================================
# Application Environment
# ============================================
NODE_ENV=production
PORT=4000

# ============================================
# Database Configuration
# ============================================
MONGODB_URI=mongodb://mongo-primary:27017,mongo-secondary:27017/dive-v3?replicaSet=rs0
MONGODB_POOL_SIZE=20

# ============================================
# Keycloak Configuration
# ============================================
KEYCLOAK_URL=https://keycloak.dive-v3.mil
KEYCLOAK_REALM=dive-v3-pilot
KEYCLOAK_CLIENT_ID=dive-v3-client
KEYCLOAK_CLIENT_SECRET=<CHANGE_ME>
KEYCLOAK_ADMIN_USERNAME=admin
KEYCLOAK_ADMIN_PASSWORD=<CHANGE_ME>

# ============================================
# OPA Configuration
# ============================================
OPA_URL=https://opa.dive-v3.mil
OPA_AUTH_TOKEN=<CHANGE_ME>

# ============================================
# KAS Configuration (Optional)
# ============================================
KAS_URL=https://kas.dive-v3.mil
KAS_AUTH_TOKEN=<CHANGE_ME>

# ============================================
# Security & Validation (Strict Mode for Production)
# ============================================
VALIDATION_STRICT_MODE=true
ALLOW_SELF_SIGNED_CERTS=false
TLS_MIN_VERSION=1.3

# ============================================
# Compliance Requirements (Strict)
# ============================================
COMPLIANCE_STRICT_MODE=true
REQUIRE_ACP240_CERT=true
REQUIRE_MFA_POLICY_DOC=true

# ============================================
# Auto-Triage Thresholds (Stricter for Production)
# ============================================
AUTO_APPROVE_THRESHOLD=90
FAST_TRACK_THRESHOLD=75
AUTO_REJECT_THRESHOLD=55

# ============================================
# SLA Configuration (Stricter for Production)
# ============================================
FAST_TRACK_SLA_HOURS=1
STANDARD_REVIEW_SLA_HOURS=12
DETAILED_REVIEW_SLA_HOURS=48

# ============================================
# Rate Limiting (Production)
# ============================================
ENABLE_RATE_LIMITING=true
API_RATE_LIMIT_WINDOW_MS=900000
API_RATE_LIMIT_MAX=50
AUTH_RATE_LIMIT_WINDOW_MS=900000
AUTH_RATE_LIMIT_MAX=3
UPLOAD_RATE_LIMIT_WINDOW_MS=3600000
UPLOAD_RATE_LIMIT_MAX=10
ADMIN_RATE_LIMIT_WINDOW_MS=900000
ADMIN_RATE_LIMIT_MAX=30

# Whitelisted IPs (comma-separated, optional)
RATE_LIMIT_WHITELIST=

# ============================================
# Performance & Caching
# ============================================
# OPA Decision Cache TTL (seconds)
OPA_CACHE_TTL_TOP_SECRET=15
OPA_CACHE_TTL_SECRET=30
OPA_CACHE_TTL_CONFIDENTIAL=60
OPA_CACHE_TTL_UNCLASSIFIED=300

# JWKS Cache TTL (seconds)
JWKS_CACHE_TTL=1800

# Cache Configuration
CACHE_MAX_SIZE=10000

# Compression
ENABLE_COMPRESSION=true
COMPRESSION_LEVEL=6

# ============================================
# Circuit Breakers
# ============================================
OPA_CIRCUIT_BREAKER_THRESHOLD=5
OPA_CIRCUIT_BREAKER_TIMEOUT=60000
KEYCLOAK_CIRCUIT_BREAKER_THRESHOLD=3
KEYCLOAK_CIRCUIT_BREAKER_TIMEOUT=30000
MONGO_CIRCUIT_BREAKER_THRESHOLD=5
MONGO_CIRCUIT_BREAKER_TIMEOUT=60000
KAS_CIRCUIT_BREAKER_THRESHOLD=3
KAS_CIRCUIT_BREAKER_TIMEOUT=30000

# ============================================
# Monitoring & Observability
# ============================================
ENABLE_METRICS=true
ENABLE_HEALTH_CHECKS=true
ENABLE_ANALYTICS=true

# Logging
LOG_LEVEL=info
LOG_FILE_PATH=/var/log/dive-v3/app.log
LOG_MAX_SIZE=10m
LOG_MAX_FILES=7

# ============================================
# CORS Configuration
# ============================================
CORS_ALLOWED_ORIGINS=https://dive-v3.mil,https://www.dive-v3.mil

# ============================================
# Security Headers
# ============================================
ENABLE_SECURITY_HEADERS=true

# ============================================
# Input Validation
# ============================================
ENABLE_INPUT_VALIDATION=true
MAX_BODY_SIZE=10485760

# ============================================
# Session Management
# ============================================
SESSION_SECRET=<CHANGE_ME_LONG_RANDOM_STRING>
SESSION_MAX_AGE=28800000
SESSION_SECURE=true
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=strict

# ============================================
# External Services Timeout (milliseconds)
# ============================================
OPA_TIMEOUT=5000
KEYCLOAK_TIMEOUT=5000
MONGODB_TIMEOUT=5000
KAS_TIMEOUT=5000

# ============================================
# Error Tracking (Optional)
# ============================================
# SENTRY_DSN=<YOUR_SENTRY_DSN>
# SENTRY_ENVIRONMENT=production

# ============================================
# Performance Targets (SLOs)
# ============================================
# These are informational for monitoring
TARGET_AVAILABILITY=99.9
TARGET_P95_LATENCY=200
TARGET_ERROR_RATE=1.0
TARGET_CACHE_HIT_RATE=85

# ============================================
# Audit & Compliance
# ============================================
AUDIT_LOG_RETENTION_DAYS=90
ENABLE_ACP240_LOGGING=true
ENABLE_DETAILED_AUDIT=true

# ============================================
# Backup Configuration
# ============================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30

# ============================================
# Feature Flags
# ============================================
ENABLE_KAS_INTEGRATION=false
ENABLE_MULTI_FACTOR_AUTH=true
ENABLE_DEVICE_COMPLIANCE_CHECK=false

# ============================================
# Email Notifications (Optional)
# ============================================
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_SECURE=true
# SMTP_USER=<SMTP_USERNAME>
# SMTP_PASS=<SMTP_PASSWORD>
# EMAIL_FROM=noreply@dive-v3.mil

# ============================================
# Kubernetes/Container Configuration
# ============================================
POD_NAME=${HOSTNAME}
POD_NAMESPACE=dive-v3
KUBERNETES_SERVICE_HOST=kubernetes.default.svc

# ============================================
# Development/Debug (Disable in Production)
# ============================================
DEBUG=false
ENABLE_STACK_TRACES=false
ENABLE_VERBOSE_LOGGING=false

