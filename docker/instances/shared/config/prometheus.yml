# DIVE V3 Prometheus Configuration
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - rules/*.yml

alerting:
  alertmanagers:
    - static_configs:
        - targets: ['alertmanager:9093']

scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # USA Instance
  - job_name: 'usa-backend'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['dive-v3-usa-backend:4000']
        labels:
          instance: 'usa'
          realm: 'USA'

  - job_name: 'usa-opa'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['dive-v3-usa-opa:8182']
        labels:
          instance: 'usa'
          realm: 'USA'

  # FRA Instance
  - job_name: 'fra-backend'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['dive-v3-fra-backend:4000']
        labels:
          instance: 'fra'
          realm: 'FRA'

  - job_name: 'fra-opa'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['dive-v3-fra-opa:8182']
        labels:
          instance: 'fra'
          realm: 'FRA'

  # GBR Instance
  - job_name: 'gbr-backend'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['dive-v3-gbr-backend:4000']
        labels:
          instance: 'gbr'
          realm: 'GBR'

  - job_name: 'gbr-opa'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['dive-v3-gbr-opa:8182']
        labels:
          instance: 'gbr'
          realm: 'GBR'

  # Redis Exporters - Hub Redis and Blacklist Redis
  - job_name: 'redis-hub'
    static_configs:
      - targets: ['hub-redis-exporter:9121']
        labels:
          instance: 'hub'
          redis_type: 'main'

  - job_name: 'redis-blacklist'
    static_configs:
      - targets: ['blacklist-redis-exporter:9122']
        labels:
          instance: 'shared'
          redis_type: 'blacklist'

  # KAS (Key Access Service) Instances
  - job_name: 'usa-kas'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    metrics_path: /metrics
    static_configs:
      - targets: ['dive-hub-kas:8080']
        labels:
          instance: 'usa'
          realm: 'USA'
          service: 'kas'

  - job_name: 'fra-kas'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    metrics_path: /metrics
    static_configs:
      - targets: ['dive-fra-kas:8080']
        labels:
          instance: 'fra'
          realm: 'FRA'
          service: 'kas'

  - job_name: 'gbr-kas'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    metrics_path: /metrics
    static_configs:
      - targets: ['dive-gbr-kas:8080']
        labels:
          instance: 'gbr'
          realm: 'GBR'
          service: 'kas'

  - job_name: 'deu-kas'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    metrics_path: /metrics
    static_configs:
      - targets: ['dive-deu-kas:8080']
        labels:
          instance: 'deu'
          realm: 'DEU'
          service: 'kas'















