# DIVE V3 Prometheus Configuration
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - rules/*.yml

alerting:
  alertmanagers:
    - static_configs:
        - targets: ['alertmanager:9093']

scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # USA Instance
  - job_name: 'usa-backend'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['dive-v3-usa-backend:4000']
        labels:
          instance: 'usa'
          realm: 'USA'

  - job_name: 'usa-opa'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['dive-v3-usa-opa:8182']
        labels:
          instance: 'usa'
          realm: 'USA'

  # FRA Instance
  - job_name: 'fra-backend'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['dive-v3-fra-backend:4000']
        labels:
          instance: 'fra'
          realm: 'FRA'

  - job_name: 'fra-opa'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['dive-v3-fra-opa:8182']
        labels:
          instance: 'fra'
          realm: 'FRA'

  # GBR Instance
  - job_name: 'gbr-backend'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['dive-v3-gbr-backend:4000']
        labels:
          instance: 'gbr'
          realm: 'GBR'

  - job_name: 'gbr-opa'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['dive-v3-gbr-opa:8182']
        labels:
          instance: 'gbr'
          realm: 'GBR'

  # Redis Exporters - Main Redis and Blacklist Redis
  - job_name: 'redis-main'
    static_configs:
      - targets: ['dive-v3-usa-redis-exporter:9121']
        labels:
          instance: 'usa'
          redis_type: 'main'

  - job_name: 'redis-blacklist'
    static_configs:
      - targets: ['redis-exporter:9121']
        labels:
          instance: 'shared'
          redis_type: 'blacklist'















