# ============================================
# DIVE V3 Environment Configuration Template
# ============================================
# Copy this file to .env.local and fill in actual values

# ============================================
# Keycloak Configuration
# ============================================
KEYCLOAK_BASE_URL=http://localhost:8081
KEYCLOAK_URL=http://localhost:8081
KEYCLOAK_REALM=dive-v3-pilot
KEYCLOAK_CLIENT_ID=dive-v3-client
KEYCLOAK_CLIENT_SECRET=your-client-secret-here-will-be-generated-by-terraform
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=admin

# Public Keycloak URLs (accessible in browser for federated logout)
NEXT_PUBLIC_KEYCLOAK_URL=http://localhost:8081
NEXT_PUBLIC_KEYCLOAK_REALM=dive-v3-pilot

# ============================================
# NextAuth Configuration
# ============================================
NEXT_PUBLIC_BASE_URL=http://localhost:3000
AUTH_URL=http://localhost:3000
AUTH_SECRET=your-auth-secret-here-min-32-chars-generate-with-openssl
NEXTAUTH_URL=http://localhost:3000

# Generate AUTH_SECRET with: openssl rand -base64 32

# ============================================
# Database Configuration
# ============================================

# PostgreSQL (for Keycloak sessions)
DATABASE_URL=postgresql://postgres:password@localhost:5433/dive_v3_app

# MongoDB (for resource metadata)
MONGODB_URL=mongodb://localhost:27017
MONGODB_DATABASE=dive-v3

# ============================================
# Backend API Configuration
# ============================================
BACKEND_PORT=4000
NEXT_PUBLIC_API_URL=http://localhost:4000
LOG_LEVEL=info

# ============================================
# OPA Configuration
# ============================================
OPA_URL=http://localhost:8181
OPA_DECISION_ENDPOINT=/v1/data/dive/authorization/decision
OPA_CACHE_TTL_SECONDS=60

# ============================================
# KAS Configuration (Stretch Goal)
# ============================================
KAS_URL=http://localhost:8080
KAS_PORT=8080
KAS_ENABLED=false

# ============================================
# Security Configuration
# ============================================

# JWT Configuration
JWT_ALGORITHM=RS256
JWT_ACCESS_TOKEN_LIFETIME=900   # 15 minutes in seconds
JWT_REFRESH_TOKEN_LIFETIME=28800  # 8 hours in seconds

# JWKS Cache
JWKS_CACHE_MAX_AGE=600000  # 10 minutes in milliseconds

# Rate Limiting
RATE_LIMIT_WINDOW_MS=60000  # 1 minute
RATE_LIMIT_MAX_REQUESTS=100  # 100 requests per minute

# ============================================
# Development vs Production
# ============================================
NODE_ENV=development

# ============================================
# Logging Configuration
# ============================================
LOG_FORMAT=json
LOG_AUDIT_RETENTION_DAYS=90

# ============================================
# Testing Configuration
# ============================================
# Mock IdP for testing (optional)
MOCK_IDP_ENABLED=false

# ============================================
# Cloudflare Zero Trust (Production Only)
# ============================================
# CLOUDFLARE_ACCESS_CLIENT_ID=
# CLOUDFLARE_ACCESS_CLIENT_SECRET=
# CLOUDFLARE_TEAM_DOMAIN=

# ============================================
# Federation Configuration (Phase 1)
# ============================================
ENABLE_FEDERATION=true
ENTITY_ID=https://dive-v3.usa.mil
FEDERATION_METADATA_URL=https://api.dive-v3.mil/federation/metadata

# OAuth 2.0 Configuration
OAUTH_ISSUER=https://api.dive-v3.mil
OAUTH_TOKEN_LIFETIME=3600      # 1 hour
OAUTH_REFRESH_LIFETIME=86400   # 24 hours
OAUTH_CODE_LIFETIME=60         # 60 seconds
DIVE_V3_AUDIENCE=dive-v3-api

# JWT Keys for OAuth (generate with: node scripts/generate-oauth-keys.js)
JWT_PRIVATE_KEY_PATH=./keys/private.pem
JWT_PUBLIC_KEY_PATH=./keys/public.pem

# Rate Limiting for External SPs
DEFAULT_SP_RATE_LIMIT=60       # requests per minute
DEFAULT_SP_BURST=10            # burst size

# Redis Configuration (OAuth cache)
REDIS_HOST=localhost
REDIS_PORT=6379
# REDIS_PASSWORD=your-redis-password-here
REDIS_URL=redis://localhost:6379

# CORS for Federation Partners (comma-separated)
# FEDERATION_ALLOWED_ORIGINS=https://sp.partner1.mil,https://sp.partner2.mil

# Keycloak Admin (for SCIM provisioning)
KEYCLOAK_ADMIN_USERNAME=admin
KEYCLOAK_ADMIN_PASSWORD=admin

# API Base URL (for discovery endpoints)
API_URL=http://localhost:4000

# ============================================
# Production Settings (Commented out for dev)
# ============================================
# NEXT_PUBLIC_BASE_URL=https://dive-v3.example.mil
# KEYCLOAK_BASE_URL=https://auth.dive-v3.example.mil
# BACKEND_API_URL=https://api.dive-v3.example.mil
# HTTPS_ENABLED=true
# SSL_CERT_PATH=/etc/ssl/certs/dive-v3.crt
# SSL_KEY_PATH=/etc/ssl/private/dive-v3.key

