# DIVE V3 Environment Variables - Local Development with HTTPS

# ============================================
# IMPORTANT: This project uses mkcert for HTTPS
# ============================================
# All URLs should use https://localhost (not http://)
# SSL certificates: keycloak/certs/certificate.pem and key.pem

# ============================================
# Keycloak Configuration (HTTPS)
# ============================================
KEYCLOAK_BASE_URL=https://localhost:8443
KEYCLOAK_URL=https://localhost:8443
KEYCLOAK_REALM=dive-v3-broker
KEYCLOAK_CLIENT_ID=dive-v3-client-broker
KEYCLOAK_CLIENT_SECRET=8AcfbgtdNIZp3tbrcmc2voiUfxNb8d6L
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=admin
KEYCLOAK_ADMIN_USERNAME=admin
KEYCLOAK_JWKS_URI=https://localhost:8443/realms/dive-v3-broker/protocol/openid-connect/certs

# Public Keycloak URLs (browser access)
NEXT_PUBLIC_KEYCLOAK_URL=https://localhost:8443
NEXT_PUBLIC_KEYCLOAK_REALM=dive-v3-broker

# Allow self-signed certificates in development
NODE_TLS_REJECT_UNAUTHORIZED=0

# ============================================
# NextAuth Configuration (HTTPS)
# ============================================
NEXT_PUBLIC_BASE_URL=https://localhost:3000
AUTH_URL=https://localhost:3000
AUTH_SECRET=fWBbrGVdA46YMp+7ZB125SXcTp6nA+mxic2KRzKg7sg=
NEXTAUTH_URL=https://localhost:3000
AUTH_TRUST_HOST=true

# ============================================
# Database Configuration
# ============================================

# PostgreSQL (for NextAuth sessions)
DATABASE_URL=postgresql://postgres:password@localhost:5433/dive_v3_app

# MongoDB (for resource metadata + SP registry)
MONGODB_URL=mongodb://admin:password@localhost:27017
MONGODB_DATABASE=dive-v3

# ============================================
# Backend API Configuration (HTTPS)
# ============================================
BACKEND_PORT=4000
NEXT_PUBLIC_API_URL=https://localhost:4000
NEXT_PUBLIC_BACKEND_URL=https://localhost:4000
BACKEND_URL=https://localhost:4000
API_URL=https://localhost:4000
LOG_LEVEL=info

# ============================================
# OPA Configuration
# ============================================
OPA_URL=http://localhost:8181
OPA_DECISION_ENDPOINT=/v1/data/dive/authorization/decision
OPA_CACHE_TTL_SECONDS=60

# ============================================
# KAS Configuration
# ============================================
KAS_URL=http://localhost:8080
KAS_PORT=8080
KAS_ENABLED=true

# ============================================
# Redis Configuration (OAuth cache + rate limiting)
# ============================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_URL=redis://localhost:6379

# ============================================
# Security Configuration
# ============================================

# JWT Configuration
JWT_ALGORITHM=RS256
JWT_ACCESS_TOKEN_LIFETIME=900   # 15 minutes
JWT_REFRESH_TOKEN_LIFETIME=28800  # 8 hours

# JWT Keys for OAuth (auto-generated or use existing)
JWT_PRIVATE_KEY_PATH=./keys/private.pem
JWT_PUBLIC_KEY_PATH=./keys/public.pem

# JWKS Cache
JWKS_CACHE_MAX_AGE=600000  # 10 minutes

# Rate Limiting
RATE_LIMIT_WINDOW_MS=60000  # 1 minute
RATE_LIMIT_MAX_REQUESTS=100

# ============================================
# Federation Configuration (Phase 1)
# ============================================
ENABLE_FEDERATION=true

# Local development URLs (HTTPS)
ENTITY_ID=https://localhost:3000
FEDERATION_METADATA_URL=https://localhost:4000/federation/metadata
OAUTH_ISSUER=https://localhost:4000

# OAuth Lifetimes
OAUTH_TOKEN_LIFETIME=3600      # 1 hour
OAUTH_REFRESH_LIFETIME=86400   # 24 hours
OAUTH_CODE_LIFETIME=60         # 60 seconds
DIVE_V3_AUDIENCE=dive-v3-api

# Rate Limiting for External SPs
DEFAULT_SP_RATE_LIMIT=60       # requests per minute
DEFAULT_SP_BURST=10            # burst size

# CORS for local development
FEDERATION_ALLOWED_ORIGINS=https://localhost:3000,https://localhost:4000

# ============================================
# Development Settings
# ============================================
NODE_ENV=development

# Logging
LOG_FORMAT=json
LOG_AUDIT_RETENTION_DAYS=90

# ============================================
# Production Settings (Future - Commented)
# ============================================
# When deploying to production, update these:
# NEXT_PUBLIC_BASE_URL=https://dive-v3.example.mil
# KEYCLOAK_BASE_URL=https://auth.dive-v3.example.mil
# API_URL=https://api.dive-v3.example.mil
# OAUTH_ISSUER=https://api.dive-v3.example.mil
# ENTITY_ID=https://dive-v3.example.mil
# NODE_TLS_REJECT_UNAUTHORIZED=1












