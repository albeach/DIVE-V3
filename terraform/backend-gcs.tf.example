# =============================================================================
# DIVE V3 - GCS Backend Configuration (Production)
# =============================================================================
# Use this configuration for production deployments with remote state.
#
# Setup:
#   1. Create GCS bucket:
#      gsutil mb -p dive25 -l us-central1 gs://dive25-terraform-state
#   
#   2. Enable versioning:
#      gsutil versioning set on gs://dive25-terraform-state
#
#   3. Set lifecycle (optional - keep 30 versions):
#      gsutil lifecycle set lifecycle.json gs://dive25-terraform-state
#
#   4. Grant access to service account:
#      gsutil iam ch serviceAccount:terraform@dive25.iam.gserviceaccount.com:objectAdmin gs://dive25-terraform-state
#
#   5. Replace backend "local" {} in pilot/backend.tf or spoke/backend.tf with:
#      terraform {
#        backend "gcs" {
#          bucket = "dive25-terraform-state"
#          prefix = "dive-v3/pilot"  # or "dive-v3/spokes" for spoke configs
#        }
#      }
#
#   6. Initialize with new backend:
#      terraform init -reconfigure
#
# State Locking:
#   GCS backend uses object versioning for state protection.
#   For proper locking, consider using Terraform Cloud or adding a
#   separate locking mechanism.
#
# Workspace Support:
#   When using workspaces with GCS backend, each workspace state is stored at:
#   gs://dive25-terraform-state/dive-v3/spokes/<workspace>/default.tfstate
#
# =============================================================================

terraform {
  backend "gcs" {
    bucket = "dive25-terraform-state"
    prefix = "dive-v3/pilot"
  }
}

# =============================================================================
# Alternative: Spoke Configuration with Workspaces
# =============================================================================
# For spoke deployments, use a shared prefix and workspaces:
#
# terraform {
#   backend "gcs" {
#     bucket = "dive25-terraform-state"
#     prefix = "dive-v3/spokes"
#   }
# }
#
# Then use workspaces for each country:
#   terraform workspace new pol
#   terraform workspace select pol
#   terraform plan -var-file=../countries/pol.tfvars
# =============================================================================
